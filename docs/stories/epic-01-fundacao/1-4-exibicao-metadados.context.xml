<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.4</storyId>
    <title>Exibição de Documentos com Metadados de Governança</title>
    <status>drafted</status>
    <generatedAt>2025-11-07</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/epic-01-fundacao/story-1.4-exibicao-metadados.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>um profissional de saúde</asA>
    <iWant>ver informações de governança dos documentos (versão, status, autor)</iWant>
    <soThat>possa confiar na validade e atualidade da informação</soThat>
    <tasks>
      - 1.4.1: Definir Esquema de Metadados
      - 1.4.2: Adicionar Metadados aos Conteúdos de Exemplo
      - 1.4.3: Customizar a UI para Exibir Metadados (usando shadcn)
      - 1.4.4: Implementar Banner de Status usando shadcn Alert (FR7)
    </tasks>
  </story>

  <acceptanceCriteria>
    - AC1: Esquema de metadados definido em `src/content/config.ts`
    - AC2: Campos obrigatórios: version, status, author, lastUpdated
    - AC3: Metadados adicionados aos conteúdos de exemplo
    - AC4: Componente `DocumentMetadata.astro` criado usando shadcn components
    - AC5: Banner de status "Revogado" implementado com shadcn Alert
    - AC6: Metadados renderizados corretamente em todas as páginas de documentos
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/PR.md</path>
        <title>PRD: Base de Conhecimento da Saúde</title>
        <section>FR7 (Status Banner)</section>
        <snippet>Exibir banner de alerta visual para documentos com status "Revogado". O sistema deve identificar documentos revogados e apresentar destaque visual imediato para evitar uso de informação desatualizada.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-01.md</path>
        <title>Epic 1 Technical Specification</title>
        <section>AC4: Document Metadata Schema (Story 1.4)</section>
        <snippet>Content schema defined in src/content/config.ts with required fields: version (string), status (enum: Rascunho|Publicado|Revisão|Revogado), author (string), lastUpdated (date). Components built with shadcn Card, Badge, Alert for metadata display and revogation warnings.</snippet>
      </doc>
      <doc>
        <path>docs/Arquitetura.md</path>
        <title>Documento de Arquitetura Fullstack</title>
        <section>Component Strategy - shadcn studio pro</section>
        <snippet>UI components based on shadcn-astro with Badge (status indicators), Card (metadata containers), Alert (warning banners). Design tokens harmonized with Starlight via app.css.</snippet>
      </doc>
      <doc>
        <path>docs/stories/epic-01-fundacao/story-1.2-personalizacao-tema.md</path>
        <title>Story 1.2: Personalização da Identidade Visual</title>
        <section>Completion Notes</section>
        <snippet>Theme variables configured in src/assets/app.css. shadcn components installed: button, card, badge, alert, input, dropdown-menu, avatar, separator.</snippet>
      </doc>
      <doc>
        <path>docs/stories/epic-01-fundacao/story-1.3-estrutura-navegacao.md</path>
        <title>Story 1.3: Criação da Estrutura de Navegação</title>
        <section>Completion Notes</section>
        <snippet>Content structure established in src/content/docs/ with 3 categories (protocolos, formularios, manuais) and 6 example documents. Documents use frontmatter with title and description.</snippet>
      </doc>
    </docs>
    <code>
      <file>
        <path>src/content/docs/protocolos/exemplo-vacinacao.mdx</path>
        <kind>content</kind>
        <symbol>example document with basic frontmatter</symbol>
        <lines>1-10</lines>
        <reason>Example document that needs metadata fields added (version, status, author, lastUpdated). Currently has only title and description.</reason>
      </file>
      <file>
        <path>src/components/ui/card.tsx</path>
        <kind>component</kind>
        <symbol>Card, CardHeader, CardTitle, CardDescription, CardContent</symbol>
        <lines>all</lines>
        <reason>shadcn Card component for building metadata container. Use Card as wrapper, CardContent for metadata fields.</reason>
      </file>
      <file>
        <path>src/components/ui/badge.tsx</path>
        <kind>component</kind>
        <symbol>Badge component with variant props</symbol>
        <lines>all</lines>
        <reason>shadcn Badge component for status and version display. Supports variants (default, secondary, destructive, outline) for different status colors.</reason>
      </file>
      <file>
        <path>src/components/ui/alert.tsx</path>
        <kind>component</kind>
        <symbol>Alert, AlertTitle, AlertDescription</symbol>
        <lines>all</lines>
        <reason>shadcn Alert component with variant="destructive" for "Revogado" status banner. Includes AlertTitle and AlertDescription for structured messaging.</reason>
      </file>
      <file>
        <path>src/lib/utils.ts</path>
        <kind>utility</kind>
        <symbol>cn function</symbol>
        <lines>all</lines>
        <reason>Utility function for conditional class merging used by all shadcn components. Required for component styling.</reason>
      </file>
      <file>
        <path>astro.config.mjs</path>
        <kind>configuration</kind>
        <symbol>starlight integration config</symbol>
        <lines>22-45</lines>
        <reason>Starlight configuration. May need to understand custom components integration or content rendering customization for metadata display.</reason>
      </file>
    </code>
    <dependencies>
      <astro>
        <version>^5.6.1</version>
        <note>SSG framework with content collections support</note>
      </astro>
      <starlight>
        <package>@astrojs/starlight</package>
        <version>^0.36.2</version>
        <note>Documentation framework - content schema configured via src/content/config.ts</note>
      </starlight>
      <shadcn>
        <package>shadcn-astro</package>
        <note>Component library - Card, Badge, Alert already installed and available</note>
      </shadcn>
      <lucide-react>
        <package>lucide-react</package>
        <note>Icon library for alert icons (AlertCircle, AlertTriangle)</note>
      </lucide-react>
      <react>
        <package>react</package>
        <version>^19.2.0</version>
        <note>Required for shadcn components</note>
      </react>
      <zod>
        <package>zod</package>
        <note>Schema validation for content collections in src/content/config.ts</note>
      </zod>
    </dependencies>
  </artifacts>

  <constraints>
    - Use Starlight content collection schema in src/content/config.ts (do not create separate config)
    - All metadata fields must be defined in Zod schema with proper types
    - Status enum must match exactly: 'Rascunho', 'Publicado', 'Revisão', 'Revogado' (Portuguese terms)
    - Badge colors must follow story specification: Rascunho (gray), Publicado (green), Revisão (yellow), Revogado (red)
    - Alert component with variant="destructive" required for Revogado status (FR7 compliance)
    - WCAG 2.1 AA compliance required for all color contrasts (NFR7)
    - Maintain consistency with existing theme in src/assets/app.css
    - Do not eject Starlight components unless absolutely necessary - prefer component overrides
    - All file paths must be project-relative (not absolute)
    - Example documents already exist and need frontmatter updates only (do not recreate files)
  </constraints>

  <interfaces>
    <content-schema>
      <kind>zod-schema</kind>
      <signature>z.object({ version: z.string(), status: z.enum(['Rascunho', 'Publicado', 'Revisão', 'Revogado']), author: z.string(), lastUpdated: z.date() })</signature>
      <path>src/content/config.ts</path>
      <note>Extends existing Starlight docsSchema. Define in defineCollection for 'docs' collection.</note>
    </content-schema>
    <metadata-component>
      <kind>astro-component</kind>
      <signature>DocumentMetadata({ version, status, author, lastUpdated })</signature>
      <path>src/components/DocumentMetadata.astro (to be created)</path>
      <note>Renders metadata using shadcn Card (container), Badge (status/version), Separator. Conditionally shows Alert for Revogado status.</note>
    </metadata-component>
    <shadcn-components>
      <kind>react-components</kind>
      <signature>Card, CardContent, Badge, Alert, AlertTitle, AlertDescription, Separator</signature>
      <path>src/components/ui/</path>
      <note>Already installed shadcn components. Import from respective files. Use client:load directive in Astro for React components.</note>
    </shadcn-components>
  </interfaces>

  <tests>
    <standards>This story focuses on content schema definition and UI component integration. Testing approach: (1) Schema validation - verify Zod schema accepts valid metadata and rejects invalid, (2) Build validation - confirm all example documents with metadata build successfully, (3) Visual inspection - verify metadata renders correctly and Revogado alert displays, (4) WCAG compliance - test color contrasts meet AA standards. No automated unit tests required for this story type per Starlight conventions.</standards>
    <locations>
      - Manual testing: Run dev server and inspect document pages
      - Build validation: pnpm build (should complete without schema errors)
      - Visual testing: Check all 6 example documents display metadata correctly
      - Accessibility: Test contrast ratios for badge colors and alert
    </locations>
    <ideas>
      - AC1: Create src/content/config.ts with docs collection schema (version, status, author, lastUpdated)
      - AC1: Verify schema validation works (test with valid and invalid frontmatter)
      - AC2: Confirm all 4 fields are required in schema definition
      - AC3: Update frontmatter in all 6 example files with realistic metadata
      - AC3: Test build succeeds with new frontmatter fields
      - AC4: Create DocumentMetadata.astro component using Card, Badge, Separator
      - AC4: Test component renders metadata fields correctly
      - AC5: Implement Alert with variant="destructive" for Revogado status
      - AC5: Verify alert only shows when status === 'Revogado'
      - AC6: Integrate DocumentMetadata component into document layout
      - AC6: Verify metadata appears on all document pages (not category index pages)
      - Badge color validation: Test each status shows correct color (visual inspection)
      - WCAG contrast: Verify badge and alert colors meet AA standard (4.5:1 for normal text)
      - Responsive test: Verify metadata displays correctly on mobile viewports
    </ideas>
  </tests>
</story-context>